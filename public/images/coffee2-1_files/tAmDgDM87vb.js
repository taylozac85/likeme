/*1374586142,171856954*/

if (self.CavalryLogger) { CavalryLogger.start_js(["OFYQ5"]); }

__d("ComposerPublishTrackingStory",["Event","ge","reportData","DOMQuery"],function(a,b,c,d,e,f){var g=b('Event'),h=b('ge'),i=b('reportData'),j=b('DOMQuery');f.init=function(k){g.listen(k,'submit',function(){var l=h('home_stream');if(!l)return;var m=j.scry(l,'.uiStreamStory')[0];if(m&&m.getAttribute('data-ft')){var n=JSON.parse(m.getAttribute('data-ft'));if(!(("mf_story_key" in n)&&("qid" in n)))return;var o={mf_story_key:n.mf_story_key,qid:n.qid};i("compose",{ft:o});}});};});
__d("ComposerXAttachmentUtils",["CSS","DataStore","DOMQuery","Focus","Input","PageTransitions","Run","StickyPlaceholderInput","tx"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DataStore'),i=b('DOMQuery'),j=b('Focus'),k=b('Input'),l=b('PageTransitions'),m=b('Run'),n=b('StickyPlaceholderInput'),o=b('tx'),p='composer_fixed_placeholder';function q(s,t){if(!h.get(s.element,p,false))s.instance.setPlaceholder(t);}var r={initMentions:function(s,t){q(s,t);var u=i.find(s.element,'textarea.input');j.set(u);},setStickyPlaceholderForMentions:function(s,t){if(i.contains(s.element,document.activeElement)&&g.hasClass(document.activeElement,'DOMControl_placeholder'))document.activeElement.blur();q(s,t);},setPlaceholderIsFixed:function(s,t){h.set(s.element,p,!!t);},setStickyPlaceholderForTypeahead:function(s,t){var u=i.find(s,'.textInput');n.setPlaceholderText(u,t);},registerInputForLeaveWarning:function(s){m.onBeforeUnload(function(){var t=l.getNextURI();if(t.getQueryData().hasOwnProperty('theater'))return;if(a.Dialog&&a.Dialog.getCurrent())return;if(s.offsetParent!==null&&!k.isEmpty(s))return "You haven't finished your post yet. Do you want to leave without finishing?";});}};e.exports=r;});
__d("ComposerXBootloadStatusAttachment",["Event","function-extensions","Arbiter","AsyncRequest","Bootloader","Class","ComposerXAttachment","ComposerXController","ComposerXDragDrop","ComposerXStore","CSS","DOM","DOMQuery","Focus","Parent","PlaceholderListener","PrivacyConst","URI","SelectorDeprecated","copyProperties","csx","cx"],function(a,b,c,d,e,f){var g=b('Event');b('function-extensions');var h=b('Arbiter'),i=b('AsyncRequest'),j=b('Bootloader'),k=b('Class'),l=b('ComposerXAttachment'),m=b('ComposerXController'),n=b('ComposerXDragDrop'),o=b('ComposerXStore'),p=b('CSS'),q=b('DOM'),r=b('DOMQuery'),s=b('Focus'),t=b('Parent'),u=b('PlaceholderListener'),v=b('PrivacyConst'),w=b('URI'),x=b('SelectorDeprecated'),y=b('copyProperties'),z=b('csx'),aa=b('cx'),ba={};function ca(da,ea){this.parent.construct(this);this._root=da;this._config=ea;}k.extend(ca,l);y(ca.prototype,{_attachmentIsActive:false,_bootloading:false,_fullVersion:false,_focusListener:null,_privacyWidgetTags:null,_scraper:null,_dragdrop:null,attachmentClassName:"_4j",getRoot:function(){return this._root;},initWithComponents:function(da){ba[this._composerID]=this;this._attachmentIsActive=true;var ea=r.find(this.getComponent('maininput').element,'textarea.input');if(this._fullVersion){this._fullInitWithComponents();}else if(!this._bootloading)if(r.contains(this._root,document.activeElement)){this._onInitialFocus();}else this._focusListener=g.listen(ea,'focus',this._onInitialFocus.bind(this));this._dragEnterHandler=h.subscribe('dragenter',function(fa,ga){if(ga.element==this._root){var ha=ga.event.dataTransfer.items,ia;if(ha)ia=n.filterImages(ha);if(ia&&ia.length>0){s.set(ea);}else{var ja=t.byClass(this._root,'focus_target');u.expandInput(ja);if(!this._bootloading&&!this._fullVersion)this._onInitialFocus();}}}.bind(this));this.getComponent('maininput').instance.setPlaceholder(this._config.mentionsPlaceholder);if(!da)s.set(ea);if(this._config.plus_version){this._dragdrop=new n(this._root,this._composerID,this._config.targetID);this._dragdrop.enableURLDropping();}},_fullInitWithComponents:function(){j.loadModules(['ComposerXPrivacyWidgetTags','URLScraper','URI'],function(da,ea,fa){this._tagger.init(this);this._privacyWidgetTags=new da(this);var ga=r.find(this.getComponent('maininput').element,'textarea.input');if(!this._scraper){this._scraper=new ea(ga);this._scraper.subscribe('match',function(ha,ia){var ja=this._getScraperEndpoint();ja.addQueryData({scrape_url:encodeURIComponent(ia.url)});m.getAttachment(this._root,ja.toString());}.bind(this));}this._scraper.enable();this._scraper.check();}.bind(this));this._initPrivacyReminder();},_initPrivacyReminder:function(){if(!this._reminderDialog||this._reminderShown)return;var da=this.getComponent('mainprivacywidget').element,ea=x.getValue(da);if(ea!==String(v.BaseValue.SELF))return;this._reminderDialog.setContext(this.getComponent('mainprivacywidget').element).show();this._reminderShown=true;new i('/ajax/privacy/reminders/log_imp').setData({type:'only_me'}).send();var fa=function(){new i('/ajax/privacy/reminders/dismiss').setData({type:'only_me'}).send();this._reminderDialog.hide();}.bind(this);this._conversionListener=x.subscribe('select',function(ga,ha){if(ha.selector==da.firstChild){var ia=x.getValue(ha.option);if(ia!==String(v.BaseValue.SELF)){new i('/ajax/privacy/reminders/log_imp').setData({type:'only_me_conversion'}).send();x.unsubscribe(this._conversionListener);}}}.bind(this));this._reminderEvents=[g.listen(this._reminderDialog.getContent(),'click',fa),g.listen(this._reminderDialog.getContext(),'click',fa)];},cleanup:function(){this._attachmentIsActive=false;if(this._focusListener){this._focusListener.remove();this._focusListener=null;}if(this._reminderDialog&&this._reminderShown){this._reminderDialog.hide();this._reminderEvents.forEach(function(da){da.remove();});this._conversionListener&&x.unsubscribe(this._conversionListener);}if(this._dragdrop){this._dragdrop.deactivate();this._dragdrop=null;}if(this._fullVersion){this._tagger.cleanup();this._privacyWidgetTags.destroy();this._privacyWidgetTags=null;this._scraper.disable();}if(this._dragEnterHandler){this._dragEnterHandler.unsubscribe();this._dragEnterHandler=null;}},reset:function(){var da=t.byClass(this._root,"child_was_focused");if(da)p.removeClass(da,"child_was_focused");if(this._tagger)this._tagger.reset();this.getComponent('maininput').instance.setPlaceholder(this._config.mentionsPlaceholder);},canSwitchAway:function(){return !t.byClass(this._root,'async_saving');},setBootloadedContent:function(da,ea,fa,ga){this._reminderDialog=ga;var ha=fa.map(function(ia){return ia.component_name;});o.waitForComponents(this._composerID,ha,function(){var ia=r.find(this._root,"._3-6"),ja=r.find(this._root,"._3-7");q.setContent(ia,da.tagger_content);q.setContent(ja,da.tagger_icons);m.addPlaceholders(this._root,this,fa);this._tagger=ea;this._fullVersion=true;if(this._attachmentIsActive){if(this._focusListener){this._focusListener.remove();this._focusListener=null;}this._fullInitWithComponents();}}.bind(this));},_getScraperEndpoint:function(){return w('/ajax/composerx/attachment/link/scraper/');},_onInitialFocus:function(){h.inform('composer/focus');m.getEndpoint(this._root,'/ajax/composerx/attachment/status/bootload/',true);this._bootloading=true;},allowOGTagPreview:function(){return true;}});ca.setBootloadedContent=function(da,ea,fa,ga,ha){var ia=ba[da];if(ia)ia.setBootloadedContent(ea,fa,ga,ha);};e.exports=ca;});
__d("ComposerXMentionsInputReset",["DOMQuery","Input"],function(a,b,c,d,e,f){var g=b('DOMQuery'),h=b('Input');function i(j){var k=g.scry(j.element,'textarea.input')[0];j.instance.reset();h.reset(k);}e.exports=i;});
__d("ComposerXOGTaggerIconReset",["CSS","cx"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('cx');function i(j){g.removeClass(j.element,"_4-jh");g.removeClass(j.element,"_509o");}e.exports=i;});
__d("ComposerXPrivacyWidgetReset",["Arbiter"],function(a,b,c,d,e,f){var g=b('Arbiter');function h(i){g.inform('Composer/changedtags',{withTags:[],mention:{},eventTag:false});}e.exports=h;});
__d("ComposerXTaggerIconReset",["CSS","cx"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('cx');function i(j){g.removeClass(j.element,"_1dsa");g.removeClass(j.element,"_1dsb");g.removeClass(j.element,"_509o");}e.exports=i;});
__d("BasePrivacyOption",["Arbiter","AudienceSelectorTags","CSS","DOM","Env","Parent","PrivacyConst","SelectorDeprecated","copyProperties","fbt","tx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AudienceSelectorTags'),i=b('CSS'),j=b('DOM'),k=b('Env'),l=b('Parent'),m=b('PrivacyConst'),n=b('SelectorDeprecated'),o=b('copyProperties'),p=b('fbt'),q=b('tx');function r(s){this._selector=l.byClass(s,'audienceSelector');this._plusLabel=j.scry(s,'.plusLabel')[0];if(!this._selector)return;this._elem=s;this._taggedIDs=[];this._tags=[];this._hasEvent=false;this._recalculateTooltipAndLabel();this._updateSelector();g.subscribe('Composer/changedtags',function(t,u){if(!this._getChangedData())return;var v=this._hasEvent;this._hasEvent=!!u.eventTag;this._tags=u.withTags.map(function(y){return y.getText();});this._taggedIDs=u.withTags.map(function(y){return y.getValue();});for(var w in u.mention)if(u.mention[w].type=='user'&&u.mention[w].uid!=k.user){this._tags.push(u.mention[w].text);this._taggedIDs.push(u.mention[w].uid);}else if(u.mention[w].type=='event')this._hasEvent=true;if(this._hasEvent&&v!=this._hasEvent)this._eventTagChanged();var x=this._recalculateTooltipAndLabel();if(x&&n.isOptionSelected(this._elem)){this._updateSelector();g.inform('SelectedPrivacyOption/changed',this._getChangedData());}}.bind(this));n.listen(this._selector,'change',this._updateSelector.bind(this));}o(r.prototype,{_eventTagChanged:function(){},_getChangedData:function(){return null;},_recalculateTooltipAndLabel:function(){var s=this._tooltip,t=this._label,u=this._getIncludedAudience(),v=this._getExcludedAudience(),w=this._getTagExpansionText();if(w)u=p._("{list of people who can see this}, {list of additional people who can see this}",[p.param("list of people who can see this",u),p.param("list of additional people who can see this",w)]);this._tooltip=this._getCombinedSentence(u,v);this._recalcLabel();return (s!=this._tooltip)||(t!=this._label);},_getIncludedAudience:function(){return this._elem.getAttribute('data-label');},_getExcludedAudience:function(){return '';},_getTagExpansionText:function(){var s=this._getTagExpansionBehavior();if(!!this._taggedIDs.length||this._alreadyHasTags()){if(s==m.TagExpansion.FRIENDS_OF_TAGGEES){if(this._hasEvent)return "friends of anyone tagged, event guests";return "friends of anyone tagged";}else if(s==m.TagExpansion.TAGGEES)return "Anyone tagged";return '';}if(this._hasEvent&&s==m.TagExpansion.FRIENDS_OF_TAGGEES)return "event guests";return '';},_getCombinedSentence:function(s,t){if(!t)return s;return p._("{list of people who can see this}; Except: {list of people who cannot see this}",[p.param("list of people who can see this",s),p.param("list of people who cannot see this",t)]);},_recalcLabel:function(){this._label=this._elem.getAttribute('data-label');if(this._showPlusLabel())this._label+=' (+)';i.conditionShow(this._plusLabel,this._showPlusLabel());},_showPlusLabel:function(){var s=this._getTagExpansionBehavior();return (!!this._taggedIDs.length&&s!=m.TagExpansion.NONE)||(!!this._hasEvent&&s==m.TagExpansion.FRIENDS_OF_TAGGEES);},_getTagExpansionBehavior:function(){return m.TagExpansion.NONE;},_alreadyHasTags:function(){var s=j.scry(this._selector,'*[data-oid]')[0];s=s&&s.getAttribute('data-oid');return s&&h.hasTags(s);},_updateSelector:function(){if(n.isOptionSelected(this._elem)){var s=i.hasClass(this._selector,'composerAudienceSelector');s&&n.setButtonLabel(this._selector,this._label);n.setButtonTooltip(this._selector,this._tooltip);return false;}return true;}});e.exports=r;});
__d("CustomPrivacyOption",["Arbiter","AsyncDialog","AsyncRequest","BasePrivacyOption","Class","DOM","Event","Form","PrivacyConst","SelectorDeprecated","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncDialog'),i=b('AsyncRequest'),j=b('BasePrivacyOption'),k=b('Class'),l=b('DOM'),m=b('Event'),n=b('Form'),o=b('PrivacyConst'),p=b('SelectorDeprecated'),q=b('copyProperties');function r(s,t,u,v,w,x,y,z,aa,ba,ca,da){if(!s)return;this._baseAudienceValue=aa;this._includedAudience=ba;this._excludedAudience=ca;this._tagExpansionBehavior=da;(function(){this.initCustomState(s,t,u);m.listen(s,'click',function(event){this.openCustomDialog(event,t,v,x,y,z);}.bind(this));p.listen(this._selector,'select',function(ea){if(ea.option._id!=this._id)this.clearCustomState();}.bind(this));this.parent.construct(this,s);}).bind(this).defer();}k.extend(r,j);q(r,{_instances:{},update:function(s,t,u,v,w,x,y,z){var aa=r._instances[s];aa._update(t,u)._updateOptionValues(w,x,y,z)._updateOption(u);g.inform('Form/change',{node:aa._container});},getData:function(s){return r._instances[s]._privacyData;},setPrivacyData:function(s,t,u){r._instances[s]._update(t,u);r._instances[s]._updateOption(u);}});q(r.prototype,{_getChangedData:function(){return {hasEvent:this._hasEvent,tags:this._taggedIDs,privacy:this._baseAudienceValue};},_updateOptionValues:function(s,t,u,v){this._baseAudienceValue=s;this._includedAudience=t;this._excludedAudience=u;this._tagExpansionBehavior=v;return this;},_updateOption:function(s){var t=p.getOption(this._selector,s)||p.getOption(this._selector,o.BaseValue.CUSTOM+'');this._recalculateTooltipAndLabel();g.inform('CustomPrivacyOption/update',{selector:this._selector,option:t,tooltip:this._tooltip,label:this._label});return this;},_getIncludedAudience:function(){return this._includedAudience;},_getExcludedAudience:function(){return this._excludedAudience;},_getTagExpansionBehavior:function(){return this._tagExpansionBehavior;},_update:function(s,t){var u=t==o.BaseValue.CUSTOM||!p.getOption(this._selector,t),v=this._selector.getAttribute('data-name');this.updateCustomState(s,u,v);return this;},initCustomState:function(s,t,u){r._instances[t]=this;this._container=l.find(s,'.customPrivacyInputs');this._id=u;this._privacyData={};var v=n.serialize(this._container);if(v.audience)this._privacyData=v.audience[u];return s;},openCustomDialog:function(event,s,t,u,v,w){var x=new i('/ajax/privacy/custom_dialog/').setData({option_id:s,id:this._id,privacy_data:this._privacyData,explain_tags:t,autosave:u,limit_to_friends:v,source:w});x.setRelativeTo(event.getTarget());h.send(x);},updateCustomState:function(s,t,u){this.clearCustomState();this._privacyData=q({},s);if(t)if(u){u=u.slice(0,-'[value]'.length);var v={};v[u]=s;n.createHiddenInputs(v,this._container,null,true);}},clearCustomState:function(){this._privacyData={};l.empty(this._container);}});e.exports=r;});
__d("DynamicIconSelector",["Button","CSS","DOM","SelectorDeprecated"],function(a,b,c,d,e,f){var g=b('Button'),h=b('CSS'),i=b('DOM'),j=b('SelectorDeprecated'),k={swapIcon:function(l){var m=j.getSelectedOptions(l)[0],n=m&&i.scry(m,'.itemIcon')[0],o=j.getSelectorButton(l);if(n){g.setIcon(o,n.cloneNode(true));}else{var p=i.scry(o,'.img')[0];p&&i.remove(p);}h.conditionClass(o,'uiSelectorChevronOnly',!n);}};j.subscribe('change',function(l,m){var n=m.selector;if(h.hasClass(n,'dynamicIconSelector'))k.swapIcon(n);});e.exports=k;});
__d("AudienceSelector",["Arbiter","AudienceSelectorTags","CSS","CustomPrivacyOption","DOM","DynamicIconSelector","PrivacyConst","SelectorDeprecated"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AudienceSelectorTags'),i=b('CSS'),j=b('CustomPrivacyOption'),k=b('DOM'),l=b('DynamicIconSelector'),m=b('PrivacyConst'),n=b('SelectorDeprecated'),o={};n.subscribe('select',function(q,r){if(!i.hasClass(r.selector,'audienceSelector'))return;var s=n.getOptionValue(r.option);r.value=s;g.inform('AudienceSelector/changed',r);if(s==m.BaseValue.CUSTOM&&!i.hasClass(r.option,'noDialog')){n.toggle(r.selector);return false;}if(i.hasClass(r.selector,'dataTooltip')){var t=k.find(r.option,'.itemAnchor').getAttribute('data-tooltip');n.setButtonTooltip(r.selector,t||null);}if(!i.hasClass(r.option,'specialOption'))return;var u=k.find(r.option,'a').getAttribute('data-type');if(i.hasClass(r.option,'moreOption')){i.addClass(r.selector,u);i.addClass(r.selector,'showSecondaryOptions');return false;}else if(i.hasClass(r.option,'returnOption')){i.removeClass(r.selector,'showSecondaryOptions');i.removeClass(r.selector,'friendList');return false;}});var p={keepSynchronized:function(q,r){o[q]||(o[q]={});o[q][r.id]=r;},setHasTags:function(q){h.setHasTags(q);}};g.subscribe('CustomPrivacyOption/update',function(q,r){if(!i.hasClass(r.selector,'audienceSelector'))return;n.setSelected(r.selector,n.getOptionValue(r.option));l.swapIcon(r.selector);var s=i.hasClass(r.selector,'composerAudienceSelector');s&&n.setButtonLabel(r.selector,r.label);n.setButtonTooltip(r.selector,r.tooltip);g.inform('AudienceSelector/update',r);});g.subscribe(['AudienceSelector/changed','AudienceSelector/update'],function(event,q){var r=n.getOptionValue(q.option),s={};if(r==m.BaseValue.CUSTOM){if(event=='AudienceSelector/changed')return;s=j.getData(q.option.id);}for(var t in o){var u=o[t];if(u[q.selector.id]){g.inform('AudienceSelector/syncNonSelectorIcon',{category:t});for(var v in u){var w=u[v];if(!w||q.selector===w)continue;if(n.getValue(w)!==r){n.setSelected(w,r);l.swapIcon(w);}if(r==m.BaseValue.CUSTOM){var x=n.getOption(w,m.BaseValue.CUSTOM+'');if(x){j.setPrivacyData(x.id,s,r);n.setButtonTooltip(w,q.tooltip);}}}}}});e.exports=p;});
__d("legacy:AudienceSelector",["AudienceSelector"],function(a,b,c,d){b('AudienceSelector');},3);
__d("FriendListPrivacyOptions",["Arbiter","AsyncDialog","AsyncRequest","Dialog","DOMQuery","PageTransitions","Parent","SelectorDeprecated","$","ge"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncDialog'),i=b('AsyncRequest'),j=b('Dialog'),k=b('DOMQuery'),l=b('PageTransitions'),m=b('Parent'),n=b('SelectorDeprecated'),o=b('$'),p=b('ge'),q=false,r=false,s=null,t={},u=function(w){if(!Object.keys(t).length)l.registerHandler(function(){t={};q=false;r=false;});var x=w.getAttribute('data-name');t[x]=w;n.listen(w,'select',function(y){var z=y.option,aa=k.find(z,'a.itemAnchor'),ba=aa.getAttribute('data-flid');if(!ba)return;var ca=aa.getAttribute('data-dynamic');if(ca&&q){v.showSmartListNux(z,ba);}else if(!ca&&r)v.showDumbListNux([ba]);});},v={listen:function(w,x,y){var z=p(w);if(!z)return;var aa=m.byClass(z,'audienceSelector');if(aa){u(aa);q=x;r=y;}},showSmartListNux:function(w,x){w=o(w);new i('/ajax/friends/lists/smart_list_publish_nux.php').setData({option_id:w.id,flid:x}).send();q=false;},setContextualDialog:function(w,x){x=o(x);var y=m.byClass(x,'audienceSelector');if(y){w.setContext(y);w.show();var z=g.subscribe('composer/publish',function(){w.hide();});w.subscribe('hide',function(){z.unsubscribe();});}},showDumbListNux:function(w){h.send(new i('/ajax/friends/lists/dumb_list_publish_nux.php').setData({flids:w}));r=false;},showBothListsNux:function(w,x){s=o(w);v.showDumbListNux(x);},setDialogX:function(w){if(!s)return;w.subscribe('hide',function(){v.showSmartListNux(s);s=null;});},setDialog:function(){if(!s)return;var w=j.getCurrent();if(w)w.setCloseHandler(function(){v.showSmartListNux(s);s=null;});}};e.exports=v;});
__d("FriendsMinusAcquaintancesPrivacyOption",["AudienceSelectorTags","BasePrivacyOption","Class","DOM","PrivacyConst","copyProperties","fbt","tx"],function(a,b,c,d,e,f){var g=b('AudienceSelectorTags'),h=b('BasePrivacyOption'),i=b('Class'),j=b('DOM'),k=b('PrivacyConst'),l=k.FriendsValue,m=b('copyProperties'),n=b('fbt'),o=b('tx');function p(q,r){this._hasRestricted=r;this.parent.construct(this,q);}i.extend(p,h);m(p.prototype,{_getChangedData:function(){return {hasEvent:this._hasEvent,tags:this._taggedIDs,privacy:l.FRIENDS_MINUS_ACQUAINTANCES};},_recalculateTooltipAndLabel:function(){var q=this._hasEvent,r=this._tags.length,s=this._tooltip,t=this._label;if(q){if(r>1||this._alreadyHasTags()){this._tooltip=this._hasRestricted?"Your friends, friends of anyone tagged and event guests; Except: Acquaintances, Restricted":"Your friends, friends of anyone tagged and event guests; Except: Acquaintances";}else if(r==1){this._tooltip=this._hasRestricted?o._("Your friends, {user}'s friends and event guests; Except: Acquaintances, Restricted",{user:this._tags[0]}):o._("Your friends, {user}'s friends and event guests; Except: Acquaintances",{user:this._tags[0]});}else this._tooltip=this._hasRestricted?"Your friends and event guests; Except: Acquaintances, Restricted":"Your friends and event guests; Except: Acquaintances";}else if(r>0||this._alreadyHasTags()){var u="friends of anyone tagged",v=n._("{people who can see this}, {list of more people who can see this}",[n.param("people who can see this","Your friends"),n.param("list of more people who can see this",u)]),w="Acquaintances";if(this._hasRestricted)w=n._("{Name of Acquaintances friend list}, {restricted}",[n.param("Name of Acquaintances friend list",w),n.param("restricted","Restricted")]);this._tooltip=this._getCombinedSentence(v,w);}else{this._tooltip="Friends except Acquaintances";if(this._hasRestricted)this._tooltip="Friends; Except: Acquaintances, Restricted";}this._recalcLabel();return ((s!=this._tooltip)||(t!=this._label));},_alreadyHasTags:function(){var q=j.scry(this._selector,'*[data-oid]')[0];q=q&&q.getAttribute('data-oid');return q&&g.hasTags(q);},_getTagExpansionBehavior:function(){return k.TagExpansion.FRIENDS_OF_TAGGEES;}});e.exports=p;});
__d("FriendsPrivacyOption",["Arbiter","BasePrivacyOption","Class","PrivacyConst","SelectorDeprecated","copyProperties","tx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('BasePrivacyOption'),i=b('Class'),j=b('PrivacyConst'),k=b('SelectorDeprecated'),l=b('copyProperties'),m=b('tx');function n(o,p){this._hasRestricted=p;this.parent.construct(this,o);}i.extend(n,h);l(n.prototype,{_getChangedData:function(){return {hasEvent:this._hasEvent,tags:this._taggedIDs,privacy:j.FriendsValue.ALL_FRIENDS};},_eventTagChanged:function(){var o=this._getChangedData();o.privacy=k.getValue(this._selector);g.inform('EventTagged/changed',o);},_recalculateTooltipAndLabel:function(){var o=this._hasEvent,p=this._tags.length,q=this._tooltip,r=this._label;if(p>2){if(o){this._tooltip=this._hasRestricted?"Your friends, friends of anyone tagged and event guests; Except: Restricted":"Your friends, friends of anyone tagged and event guests";}else this._tooltip=this._hasRestricted?"Your friends and friends of anyone tagged; Except: Restricted":"Your friends and friends of anyone tagged";}else if(p==2){if(o){if(this._hasRestricted){this._tooltip="Your friends, friends of anyone tagged and event guests; Except: Restricted";}else this._tooltip="Your friends, friends of anyone tagged and event guests";}else if(this._hasRestricted){this._tooltip=m._("Your friends, {user}'s friends and {user2}'s friends; Except: Restricted",{user:this._tags[0],user2:this._tags[1]});}else this._tooltip=m._("Your friends, {user}'s friends and {user2}'s friends",{user:this._tags[0],user2:this._tags[1]});}else if(p==1){if(o){if(this._hasRestricted){this._tooltip=m._("Your friends, {user}'s friends and event guests; Except: Restricted",{user:this._tags[0]});}else this._tooltip=m._("Your friends, {user}'s friends and event guests",{user:this._tags[0]});}else if(this._hasRestricted){this._tooltip=m._("Your friends and {user}'s friends; Except: Restricted",{user:this._tags[0]});}else this._tooltip=m._("Your friends and {user}'s friends",{user:this._tags[0]});}else if(o){this._tooltip=this._hasRestricted?"Your friends and event guests; Except: Restricted":"Your friends and event guests";}else this._tooltip=this._hasRestricted?"Your friends; Except: Restricted":"Your friends";this._recalcLabel();return (q!=this._tooltip)||(r!=this._label);},_getTagExpansionBehavior:function(){return j.TagExpansion.FRIENDS_OF_TAGGEES;}});e.exports=n;});
__d("MetaComposerEdDialog",["Animation","Arbiter","ARIA","AsyncRequest","copyProperties","CSS","DOM","Ease","ge","Parent","SelectorDeprecated","Vector"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('Arbiter'),i=b('ARIA'),j=b('AsyncRequest'),k=b('copyProperties'),l=b('CSS'),m=b('DOM'),n=b('Ease'),o=b('ge'),p=b('Parent'),q=b('SelectorDeprecated'),r=b('Vector'),s=null;function t(u){this._dialog=u.dialog;this.config=u;this._init();}t.init=function(u){if(s){s.config.show_audience=u.show_audience;u.dialog.destroy();return;}s=new t(u);};k(t.prototype,{_init:function(){h.subscribe('ComposerXStatusAttachment/ready',function(){if(this.config.show_audience){this._sendEducationRequest({},'/ajax/composer/audience/education',this._handlerCustomDuration.bind(this,6000));this.config.show_audience=false;}}.bind(this));if(this.config.show_sticky)h.subscribe('composer/mutate',function(u,v){this._sendEducationRequest({sticky_num:this.config.n_sticky_shown},'/ajax/composer/audience/sticky_education');}.bind(this));if(this.config.show_event_tags)if(this.config.n_event_tag_shown===0){h.subscribe('EventTagged/changed',function(u,v){this._sendEducationRequest({selector:'div.fbComposerAudienceTourContext',privacy:v.privacy,event_tag_num:this.config.n_event_tag_shown},'/ajax/events/tagging/user_education');}.bind(this));h.subscribe(['composer/publish','composer/reset'],function(){var u=o("event_tagging_tag_expansion_NUX");u&&l.hide(u);}.bind(this));}else h.subscribe('EventTagged/changed',function(u,v){this._sendEducationRequest({ids:v.tags,from:'AtTagger',hasEvent:v.hasEvent,type:v.privacy,tag_num:this.config.n_tag_shown,event_tag_num:this.config.n_event_tag_shown},'ajax/composer/audience/tag_education',this._handler.bind(this));}.bind(this));if(this.config.show_tags)h.subscribe('SelectedPrivacyOption/changed',function(u,v){this._sendEducationRequest({ids:v.tags,from:'WithTagger',hasEvent:v.hasEvent,type:v.privacy,tag_num:this.config.n_tag_shown,event_tag_num:this.config.n_event_tag_shown},'/ajax/composer/audience/tag_education',this._handler.bind(this));}.bind(this));q.subscribe('open',this._killAnim.bind(this));},_sendEducationRequest:function(u,v,w){if(!this._updateDialogContext())return;this._async&&this._async.abort();this._async=new j(v);this._async.setData(u).setHandler(w).send();},_updateDialogContext:function(){var u=m.scry(document.body,'div.composerAudienceWrapper'),v,w;for(var x=0;x<u.length;x++){v=u[x];w=r.getElementPosition(v);if(v&&w.x>0&&w.y>0){this._dialog.setContext(v);return true;}}return false;},_handler:function(u){this._handlerCustomDuration(1500,u);},_handlerCustomDuration:function(u,v){var w=v.payload;if(!w||!this._updateDialogContext())return;var x=this._dialog.getContent().firstChild;m.setContent(x,w);i.announce(m.getText(x));this._dialog.show();var y=p.byClass(x,'metaComposerUserEd');if(this._anim){this._anim.stop();this._anim=new g(y);}else this._anim=new g(y).from('opacity',0);this._anim.to('opacity',1).ease(n.sineOut).checkpoint().duration(u).checkpoint().to('opacity',0).ease(n.sineOut).checkpoint().ondone(this._killAnim.bind(this)).go();},_killAnim:function(u,v){if(this._anim){this._dialog.hide();this._anim.stop();this._anim=null;}}});e.exports=t;});
__d("OnlyMePrivacyOption",["BasePrivacyOption","copyProperties","Class","PrivacyConst","tx"],function(a,b,c,d,e,f){var g=b('BasePrivacyOption'),h=b('copyProperties'),i=b('Class'),j=b('PrivacyConst'),k=b('tx');function l(m){this.parent.construct(this,m);}i.extend(l,g);h(l.prototype,{_getChangedData:function(){return {hasEvent:this._hasEvent,tags:this._taggedIDs,privacy:j.FriendsValue.SELF};},_getIncludedAudience:function(){return "Only me";},_getTagExpansionBehavior:function(){return j.TagExpansion.TAGGEES;},_recalculateTooltipAndLabel:function(){var m=this._tooltip,n=this._label;if(this._getTagExpansionText())this._tooltip=this._getTagExpansionText();this._recalcLabel();return (m!=this._tooltip)||(n!=this._label);}});e.exports=l;});
__d("legacy:DynamicIconSelector",["DynamicIconSelector"],function(a,b,c,d){a.DynamicIconSelector=b('DynamicIconSelector');},3);
__d("MentionsInputMatchers",[],function(a,b,c,d,e,f){var g=['@','\\uff20','+','\\uff0b'].join(''),h='.,*?$|#{}()\\^\\-\\[\\]\\\\\/!%&\'"~=<>_:;',i='\\b[A-Z][^ A-Z'+h+']',j='([^'+g+h+']|['+h+'][^ '+h+'])',k='(?:^|\\s)(?:['+g+']('+j+'{0,20}))',l='(?:(?:^|[^#])('+i+'+)|'+k+')',m='(?:'+i+'{4,})',n='#\\uFF03',o={trigger:new RegExp('['+g+']$'),hashtagTrigger:new RegExp('['+n+']'),mainMatcher:new RegExp(k+'$'),autoMatcher:new RegExp(l+'$'),userMatcher:new RegExp(m+'$')};e.exports=o;});
__d("MentionsInput",["function-extensions","Arbiter","ArbiterMixin","Bootloader","CSS","DataStore","DOM","Event","HTML","Input","InputSelection","Keys","MentionsInputMatchers","Parent","Style","TokenizeUtil","UserAgent","copyProperties","htmlize","removeFromArray","repeatString"],function(a,b,c,d,e,f){b('function-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Bootloader'),j=b('CSS'),k=b('DataStore'),l=b('DOM'),m=b('Event'),n=b('HTML'),o=b('Input'),p=b('InputSelection'),q=b('Keys'),r=b('MentionsInputMatchers'),s=b('Parent'),t=b('Style'),u=b('TokenizeUtil'),v=b('UserAgent'),w=b('copyProperties'),x=b('htmlize'),y=b('removeFromArray'),z=b('repeatString'),aa='\uFEFF',ba=new RegExp(aa,'g'),ca=function(ja){return ja+aa;},da='\uFFFD',ea=/@+\[[0-9]+\:([^\]]|\\\])*\]+/g,fa=/[\\\]:]/g;function ga(ja,ka){return ja.replace(ka,z(' ',ka.length));}function ha(ja,ka){return ja.substring(0,ka)+ja.substring(ka+1);}function ia(ja,ka,la,ma,na,oa){k.set(ja,'MentionsInput',this);this._root=ja;this._typeahead=ka;this._input=la;var pa=null,qa=this.init.bind(this,ma,na,oa);try{pa=document.activeElement===this._input;}catch(ra){}if(pa){qa.defer();}else var sa=m.listen(this._input,'focus',function(){qa.defer();sa.remove();});this._hasHashtags=ma.hashtags;this._hashtags=[];}ia.getInstance=function(ja){var ka=s.byClass(ja,'uiMentionsInput');return ka?k.get(ka,'MentionsInput'):null;};w(ia.prototype,h,{init:function(ja,ka,la){if(this._initialized)return;this._initialized=true;this._highlighter=l.find(this._root,'.highlighter');this._highlighterInner=this._highlighter.firstChild;this._highlighterContent=l.find(this._root,'.highlighterContent');this._hiddenInput=l.find(this._root,'.mentionsHidden');this._placeholder=this._input.getAttribute('placeholder')||'';this._maxMentions=ja.max||6;this._metrics=la;if(!this._hiddenInput.name){var ma=this._input.name;this._input.name=ma+'_text';this._hiddenInput.name=ma;}this._initEvents();this._initTypeahead();this.reset(ka);this.inform('init',null,g.BEHAVIOR_STATE);},reset:function(ja){if(!this._initialized)return;this._mentioned={};this._orderedUIDs=[];this._numMentioned=0;this._filterData=null;this._hiddenInput&&(this._hiddenInput.value='');this._highlighterContent&&l.empty(this._highlighterContent);this._highlighterAuxContent&&l.remove(this._highlighterAuxContent);this._highlighterAuxContent=null;o.setPlaceholder(this._input,this._placeholder);t.set(this._typeahead.getElement(),'height','auto');var ka=ja&&ja.value||'',la=ja&&ja.mentions;if(la&&la.length){var ma=[];la.forEach(function(na){ma.push(na.offset+na.length);delete na.offset;delete na.length;this._addToken(na);},this);ma.reverse().forEach(function(na){ka=ka.substring(0,na)+aa+ka.substring(na);});}o.setValue(this._input,ka);this._updateTypeahead();this._updateWidth();this._update();},getValue:function(){return this._getMarkedValue().replace(ba,'');},_getMarkedValue:function(){return o.getValue(this._input);},getRawValue:function(){this._update();return o.getValue(this._hiddenInput);},checkValue:function(){var ja=this._typeahead.getCore().getValue();if(r.trigger.exec(ja)||ja==='')this.inform('sessionEnd',{});},getTypeahead:function(){return this._typeahead;},_initEvents:function(){var ja=this._update.bind(this);m.listen(this._input,{input:ja,keyup:ja,change:ja,blur:this._handleBlur.bind(this),focus:this._handleFocus.bind(this),keydown:this._handleKeydown.bind(this)});if(this._metrics){this._metrics._reset();this._metrics.bindSessionStart(this._typeahead,'render',true);this._metrics.bindSessionEnd(this._typeahead.getView(),'select',true);this._metrics.bindSessionEnd(this,'sessionEnd',false);m.listen(this._input,'keyup',function(event){this.checkValue.bind(this).defer();}.bind(this));}},_initTypeahead:function(){this._typeahead.subscribe('select',function(oa,pa){var qa=pa.selected;this._addToken({uid:qa.uid,text:qa.text,type:qa.type,weakreference:qa.weak_reference});this.updateValue();}.bind(this));var ja=this._input,ka=null;function la(){if(ka===null){ka=o.getSubmitOnEnter(ja);o.setSubmitOnEnter(ja,false);}}function ma(){if(ka!==null){o.setSubmitOnEnter(ja,ka);ka=null;}}this._typeahead.subscribe('reset',ma);this._typeahead.subscribe('render',la);this._typeahead.subscribe('highlight',function(oa,pa){pa.index>=0?la():ma();});this._typeahead.subscribe('query',function(){this._filterData=null;}.bind(this));var na=this._typeahead.getCore();na.suffix=aa;this._handleFocus();},_handleBlur:function(){if(this._filterToken){this._filterToken.remove();this._filterToken=null;}},_handleFocus:function(){if(!this._filterToken)this._filterToken=this._typeahead.getData().addFilter(this._filterResults.bind(this));this._updateWidth();},_handleKeydown:function(event){var ja=event.keyCode;if(ja==q.BACKSPACE||ja==q.DELETE)this._handleBackspaceAndDelete(event,ja);if(ja==q.LEFT||ja==q.RIGHT)setTimeout(this._handleLeftAndRight.bind(this,ja),10);},_handleLeftAndRight:function(ja){var ka=this._getMarkedValue(),la=p.get(this._input),ma=la.start,na=la.end,oa=ja==q.LEFT,pa=ja==q.RIGHT;if(ma==na){var qa=oa?-1:1;if(ka.charAt(ma)==aa)p.set(this._input,ma+qa);}else if(oa&&ka.charAt(ma)==aa){p.set(this._input,ma-1,na);}else if(oa&&ka.charAt(na)==aa){p.set(this._input,ma,na-1);}else if(pa&&ka.charAt(na)==aa){p.set(this._input,ma,na+1);}else if(pa&&ka.charAt(ma)==aa)p.set(this._input,ma+1,na);},_handleBackspaceAndDelete:function(event,ja){var ka=p.get(this._input),la=false;if(ka.start!==ka.end)if(this._offsetIsInsideMention(ka.start+1)&&this._offsetIsInsideMention(ka.end)){la=(ja===q.BACKSPACE);}else return;var ma=ja===q.DELETE?1:-1,na=ma+(la?ka.end:ka.start),oa=this._getMarkedValue(),pa=oa;for(var qa=0;qa<this._orderedUIDs.length;++qa){var ra=this._mentioned[this._orderedUIDs[qa]],sa=ra.text,ta=ca(sa),ua=pa.indexOf(ta),va=ua+ta.length;if(na<ua||na>=va){pa=ga(pa,ta);continue;}var wa,xa;if(ra.type!='user'){wa=0;xa=[sa];}else{wa=ta.substring(0,na-ua).split(' ').length-1;xa=sa.split(' ');}var ya=xa.splice(wa,1)[0],za=xa.join(' '),ab=wa===0?ua:va-ya.length-1;if(za){ra.text=za;za=ca(za);}else this._removeToken(ra.uid);var bb=oa.substring(0,ua)+za+oa.substring(va);o.setValue(this._input,bb);p.set(this._input,ab);this._update();event.kill();break;}},_offsetIsInsideMention:function(ja){for(var ka=0;ka<this._offsets.length;ka++)if(ja>this._offsets[ka][0]&&ja<=this._offsets[ka][1])return true;return false;},_filterResults:function(ja){if(this._filterData===null){var ka=p.get(this._input).start;if(this._offsetIsInsideMention(ka)){this._filterData={caretIsInsideMention:true};return false;}var la=this._typeahead.getCore();this._filterData={value:la.getValue(),rawValue:la.getRawValue()};}if(this._filterData.caretIsInsideMention)return false;if(r.mainMatcher.test(this._filterData.rawValue))return true;if(ja.type!='user')return false;if(ja.disable_autosuggest)return false;if(r.userMatcher.test(this._filterData.value))return true;return u.isExactMatch(this._filterData.value,this._typeahead.getData().getTextToIndex(ja));},_addToken:function(ja){var ka=ja.uid;if(!this._mentioned.hasOwnProperty(ka)){this._mentioned[ka]=ja;this._orderedUIDs.push(ka);this._numMentioned++;this._updateTypeahead();}},_removeToken:function(ja){if(this._mentioned.hasOwnProperty(ja)){delete this._mentioned[ja];y(this._orderedUIDs,ja);this._numMentioned--;this._updateTypeahead();}},_update:function(){var ja=this._getMarkedValue();if(ja==this._value)return;this._value=ja;this._updateMentions();this._updateDirection.bind(this).defer();this.updateValue();},_updateMentions:function(){this._offsets=[];var ja=this._getMarkedValue(),ka=ja;for(var la=0;la<this._orderedUIDs.length;++la){var ma=this._orderedUIDs[la],na=ca(this._mentioned[ma].text),oa=ka.indexOf(na);if(oa==-1)this._removeToken(ma);ka=ga(ka,na);this._offsets.push([oa,oa+na.length]);}var pa=ja;while((oa=ka.indexOf(aa))>-1){pa=ha(pa,oa);ka=ha(ka,oa);}if(ja!==pa){var qa=p.get(this._input);o.setValue(this._input,pa);p.set(this._input,qa.start);this._value=pa;}},_renderHashtags:function(ja){if(!this._hasHashtags)return x(ja);if(!this._hashtagParser){if(r.hashtagTrigger.exec(ja))this.bootloadHashtagParser();if(!this._hashtagParser)return x(ja);}this._hashtags=this._hashtagParser.parse(ja);var ka=[],la=0;for(var ma=0;ma<this._hashtags.length;ma++){var na=this._hashtags[ma];ka.push(x(ja.substring(la,na.rawOffset)),'<b>',na.marker,na.tag,'</b>');la=na.rawOffset+na.marker.length+na.tag.length;}ka.push(x(ja.substring(la)));return ka.join('');},updateValue:function(){var ja=this._value=this._getMarkedValue(),ka=this._orderedUIDs,la=ja.replace(ea,da);for(var ma=0;ma<ka.length;++ma){var na='@['+ka[ma]+':]',oa=ca(this._mentioned[ka[ma]].text);la=la.replace(oa,na);ja=ja.replace(oa,na);}var pa=this._renderHashtags(ja);for(var ma=0;ma<ka.length;++ma){var qa=ka[ma],ra=this._mentioned[qa],sa=ra.text,ta=ra.weakreference?'<b class="weak">':'<b>';pa=pa.replace('@['+qa+':]',ta+x(ca(sa))+'</b>');sa=sa.replace(fa,function(ua){return '\\'+ua;});la=la.replace('@['+qa+':]','@['+qa+':'+sa+']');}if(v.ie())pa=pa.replace(/ /g,'&nbsp;<wbr/>');l.setContent(this._highlighterContent,n(pa));this._hiddenInput.value=la;this._updateHighlighter();this._updateHeight();},_updateDirection:function(){var ja=t.get(this._input,'direction');if(ja==this._dir)return;this._dir=ja;t.set(this._highlighter,'direction',ja);if(ja=='rtl'){t.set(this._highlighter,'text-align','right');}else t.set(this._highlighter,'text-align','left');},_updateWidth:function(){var ja=t.getFloat.curry(this._input),ka=this._input.offsetWidth-ja('paddingLeft')-ja('paddingRight')-ja('borderLeftWidth')-ja('borderRightWidth');if(v.firefox())ka-=2;if(v.ie()<=7){ka-=t.getFloat(this._highlighterInner,'paddingLeft');this._highlighter.style.zoom=1;}this._highlighterInner.style.width=Math.max(ka,0)+'px';},_updateHeight:function(){if(this._highlighterAuxContent){var ja=this._highlighter.offsetHeight,ka=this._typeahead.getElement();if(ja>ka.offsetHeight){t.set(ka,'height',ja+'px');g.inform('reflow');}}},_updateTypeahead:function(){var ja=this._typeahead.getCore(),ka=null;if(!this._maxMentions||this._numMentioned<this._maxMentions)ka=r.autoMatcher;ja.matcher=ka;ja.setExclusions(this._orderedUIDs);this.inform('update',{mentioned:this._mentioned});},setPlaceholder:function(ja){this._placeholder=ja;if(!this.hasAuxContent())o.setPlaceholder(this._input,ja);},_updateHighlighter:function(){if(this._highlighterContent)j.conditionShow(this._highlighterContent,this._numMentioned>0||this.hasAuxContent()||this._hashtags.length);},setAuxContent:function(ja){if(this._highlighterContent){if(!this._highlighterAuxContent){this._highlighterAuxContent=l.create('span',{className:'highlighterAuxContent'});l.insertAfter(this._highlighterContent,this._highlighterAuxContent);}l.setContent(this._highlighterAuxContent,ja);if(ja){o.setPlaceholder(this._input,'');}else o.setPlaceholder(this._input,this._placeholder);this._updateHighlighter();this._updateHeight();}},hasAuxContent:function(){var ja=this.getAuxContentRoot();return ja&&ja.innerHTML.length>0;},getAuxContentRoot:function(){return this._highlighterAuxContent;},addMention:function(ja){var ka=this._getMarkedValue();if(ka!=='')ka+=' ';o.setValue(this._input,ka+ca(ja.text)+' ');this._addToken(ja);this._update();},getMentions:function(){return this._mentioned;},bootloadHashtagParser:function(){if(!this._hashtagParser)i.loadModules(['HashtagParser'],function(ja){this._hashtagParser=ja;if(this._initialized)this._update();}.bind(this));}});e.exports=ia;});
__d("MentionsTypeaheadAreaView",["Class","ContextualTypeaheadView","Parent","copyProperties"],function(a,b,c,d,e,f){var g=b('Class'),h=b('ContextualTypeaheadView'),i=b('Parent'),j=b('copyProperties');function k(l,m){this.parent.construct(this,l,m);}g.extend(k,h);j(k.prototype,{getContext:function(){return i.byClass(this.element,'uiMentionsInput');}});e.exports=k;});
__d("legacy:MentionsInput",["MentionsInput"],function(a,b,c,d){a.MentionsInput=b('MentionsInput');},3);
__d("TypeaheadAreaCore",["Class","InputSelection","TypeaheadCore","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('Class'),h=b('InputSelection'),i=b('TypeaheadCore'),j=b('copyProperties'),k=b('emptyFunction');function l(m){this.parent.construct(this,m);this.matcher=new RegExp(this.matcher+'$');this.preventFocusChangeOnTab=true;}g.extend(l,i);j(l.prototype,{prefix:'',suffix:', ',matcher:"\\b[^,]*",click:k,select:function(m){this.parent.select(m);var n=this.element.value,o=this.prefix+m.text+this.suffix;this.expandBounds(n,o);var p=n.substring(0,this.start),q=n.substring(this.end);this.element.value=p+o+q;h.set(this.element,p.length+o.length);},expandBounds:function(m,n){m=m.toLowerCase();n=n.toLowerCase();var o,p,q,r,s=/\s/;p=m.substring(this.start,this.end);q=n.indexOf(p);o=this.start;while(o>=0&&q>=0){r=m.charAt(o-1);if(!r||s.test(r))this.start=o;p=r+p;q=n.indexOf(p);o--;}p=m.substring(this.start,this.end);q=n.indexOf(p);o=this.end;while(o<=m.length&&q>=0){r=m.charAt(o);if(!r||s.test(r))this.end=o;p=p+r;q=n.indexOf(p);o++;}},getRawValue:function(){var m=h.get(this.element).start||0;return this.parent.getValue().substring(0,m);},getValue:function(){var m=this.matcher&&this.matcher.exec(this.getRawValue());if(!m)return '';var n=m[0],o=m.index+n.length;n=n.replace(/^\s/,'');var p=n.length;n=n.replace(/\s$/,'');var q=p-n.length;this.start=o-p;this.end=o+q;return m[2]||m[1]||m[0];}});e.exports=l;});
__d("TypeaheadMetrics",["Event","AsyncRequest","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('Event'),h=b('AsyncRequest'),i=b('copyProperties'),j=b('emptyFunction');function k(l){this.extraData={};i(this,l);}i(k.prototype,{endPoint:'/ajax/typeahead/record_basic_metrics.php',init:function(l){this.init=j;this.core=l.getCore();this.view=l.getView();this.data=l.getData();this.stats={};this.sessionActive=false;this._sessionStartEvents=[];this._sessionEndEvents=[];this._reset();this.initEvents();},_reset:function(){this.stats={};this.avgStats={};this.sessionActive=false;this.results=null;this.sid=Math.floor(Date.now()*Math.random());this.data.setQueryData({sid:this.sid});},recordSelect:function(l){var m=l.selected;if(m.uid==null){this.recordStat('selected_id','SELECT_NULL');}else this.recordStat('selected_id',m.uid);this.recordStat('selected_type',m.type);this.recordStat('selected_position',l.index);this.recordStat('selected_with_mouse',l.clicked?1:0);this.recordStat('selected_query',l.query);this._sessionEnd();},bindSessionStart:function(l,event,m){if(m)for(var n=0;n<this._sessionStartEvents.length;++n){var o=this._sessionStartEvents[n];o.obj.unsubscribe(o.token);}this._sessionStartEvents.push({obj:l,token:l.subscribe(event,function(p,q){this._sessionStart();}.bind(this))});},bindSessionEnd:function(l,event,m){if(m)for(var n=0;n<this._sessionEndEvents.length;++n){var o=this._sessionEndEvents[n];o.obj.unsubscribe(o.token);}this._sessionEndEvents.push({obj:l,token:l.subscribe(event,function(p,q){this._sessionEnd();}.bind(this))});},initEvents:function(){this.bindSessionStart(this.core,'focus',false);this.bindSessionEnd(this.core,'blur',false);this.view.subscribe('select',function(l,m){this.recordSelect(m);}.bind(this));this.bindSessionEnd(this.view,'select',false);this.view.subscribe('render',function(l,m){this.results=m;}.bind(this));this.data.subscribe('beforeQuery',function(l,m){if(!m.value)return;this.query=m.value;this.recordCountStat('num_queries');}.bind(this));this.data.subscribe('beforeFetch',function(l,m){if(m.fetch_context.bootstrap){this.bootstrapBegin=Date.now();}else m.fetch_context.queryBegin=Date.now();}.bind(this));this.data.subscribe('fetchComplete',function(l,m){if(m.fetch_context.bootstrap){this.recordAvgStat('bootstrap_latency',Date.now()-this.bootstrapBegin);var n={};m.response.payload.entries.forEach(function(o){if(!n[o.type]){n[o.type]=1;}else n[o.type]++;});this.recordStat('bootstrap_response_types',n);this.bootstrapped=true;}else{if('filtered_count' in m.response.payload)this.recordStat('filtered_count',m.response.payload.filtered_count);this.recordAvgStat('avg_query_latency',Date.now()-m.fetch_context.queryBegin);}}.bind(this));this.data.subscribe('dirty',function(l,m){this.bootstrapped=false;});},_sessionStart:function(){if(this.sessionActive)return;this.sessionActive=true;},_sessionEnd:function(){if(!this.sessionActive)return;this.sessionActive=false;this.submit();this._reset();},recordStat:function(l,m){this.stats[l]=m;},recordCountStat:function(l){var m=this.stats[l];this.stats[l]=m?m+1:1;},recordAvgStat:function(l,m){if(this.avgStats[l]){this.avgStats[l][0]+=m;++this.avgStats[l][1];}else this.avgStats[l]=[m,1];},submit:function(){if(Object.keys(this.stats).length){i(this.stats,this.extraData);if(this.results){var l=(this.results).map(function(o,p){return o.uid;});this.recordStat('candidate_results',JSON.stringify(l));}if(this.query)this.recordStat('query',this.query);if(this.sid)this.recordStat('sid',this.sid);if(this.bootstrapped)this.recordStat('bootstrapped',1);for(var m in this.avgStats){var n=this.avgStats[m];this.stats[m]=n[0]/n[1];}new h().setURI(this.endPoint).setMethod('POST').setData({stats:this.stats}).send();this._reset();}}});k.register=function(l,m,n){if(document.activeElement===l){m.init(n);}else var o=g.listen(l,'focus',function(){m.init(n);o.remove();});};e.exports=k;});
__d("TypeaheadHoistFriends",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties');function h(i){this._typeahead=i;}g(h.prototype,{_subscription:null,enable:function(){var i=this._typeahead.getView();this._subscription=i.subscribe('beforeRender',function(j,k){var l=[],m=[],n=[];for(var o=0;o<k.results.length;++o){var p=k.results[o];if(p.type=='header'){n=n.concat(m,l);n.push(p);m=[];l=[];}else if(p.type=='user'&&p.bootstrapped){m.push(p);}else l.push(p);}k.results=n.concat(m,l);});},disable:function(){this._typeahead.getView().unsubscribe(this._subscription);this._subscription=null;}});e.exports=h;});
__d("legacy:HoistFriendsTypeaheadBehavior",["TypeaheadHoistFriends"],function(a,b,c,d){var e=b('TypeaheadHoistFriends');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.hoistFriends=function(f){f.enableBehavior(e);};},3);